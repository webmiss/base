(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5e27b9af"],{1276:function(t,e,i){"use strict";var o=i("d784"),n=i("44e7"),s=i("825a"),c=i("1d80"),r=i("4840"),l=i("8aa5"),a=i("50c4"),u=i("14c3"),h=i("9263"),f=i("d039"),d=[].push,b=Math.min,m=4294967295,p=!f((function(){return!RegExp(m,"y")}));o("split",2,(function(t,e,i){var o;return o="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(t,i){var o=String(c(this)),s=void 0===i?m:i>>>0;if(0===s)return[];if(void 0===t)return[o];if(!n(t))return e.call(o,t,s);var r,l,a,u=[],f=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),b=0,p=new RegExp(t.source,f+"g");while(r=h.call(p,o)){if(l=p.lastIndex,l>b&&(u.push(o.slice(b,r.index)),r.length>1&&r.index<o.length&&d.apply(u,r.slice(1)),a=r[0].length,b=l,u.length>=s))break;p.lastIndex===r.index&&p.lastIndex++}return b===o.length?!a&&p.test("")||u.push(""):u.push(o.slice(b)),u.length>s?u.slice(0,s):u}:"0".split(void 0,0).length?function(t,i){return void 0===t&&0===i?[]:e.call(this,t,i)}:e,[function(e,i){var n=c(this),s=void 0==e?void 0:e[t];return void 0!==s?s.call(e,n,i):o.call(String(n),e,i)},function(t,n){var c=i(o,t,this,n,o!==e);if(c.done)return c.value;var h=s(t),f=String(this),d=r(h,RegExp),g=h.unicode,j=(h.ignoreCase?"i":"")+(h.multiline?"m":"")+(h.unicode?"u":"")+(p?"y":"g"),v=new d(p?h:"^(?:"+h.source+")",j),O=void 0===n?m:n>>>0;if(0===O)return[];if(0===f.length)return null===u(v,f)?[f]:[];var y=0,_=0,w=[];while(_<f.length){v.lastIndex=p?_:0;var T,k=u(v,p?f:f.slice(_));if(null===k||(T=b(a(v.lastIndex+(p?0:_)),f.length))===y)_=l(f,_,g);else{if(w.push(f.slice(y,_)),w.length===O)return w;for(var M=1;M<=k.length-1;M++)if(w.push(k[M]),w.length===O)return w;_=y=T}}return w.push(f.slice(y)),w}]}),!p)},"34c9":function(t,e,i){},"3cb1":function(t,e,i){"use strict";i.r(e);i("b0c0");var o=i("7a23"),n=function(t){return Object(o["y"])("data-v-54c634f4"),t=t(),Object(o["w"])(),t},s=n((function(){return Object(o["i"])("td",{width:"30"},"ID",-1)})),c=n((function(){return Object(o["i"])("td",{width:"90"},"房间ID",-1)})),r=n((function(){return Object(o["i"])("td",{width:"120"},"名称",-1)})),l=n((function(){return Object(o["i"])("td",{width:"80"},"主播",-1)})),a=n((function(){return Object(o["i"])("td",{width:"80"},"观众",-1)})),u=n((function(){return Object(o["i"])("td",null,"信息",-1)})),h=Object(o["j"])("主播"),f=Object(o["j"])("观众"),d=n((function(){return Object(o["i"])("td",null,null,-1)})),b={class:"player_video"},m={class:"player_msg"},p={class:"player_msg_list",ref:"MsgList"},g={class:"flex"},j=n((function(){return Object(o["i"])("div",{class:"img"},null,-1)})),v={class:"info"},O={class:"content"},y={key:0,class:"player_tools"},_=n((function(){return Object(o["i"])("div",{id:"playerView"},null,-1)})),w=n((function(){return Object(o["i"])("div",{class:"player_emoji"}," 表情 ",-1)})),T={class:"player_send flex"},k={class:"player_send_msg"},M={key:0,class:"player_send_login"},I=Object(o["j"])('需要" '),S=Object(o["j"])(' "才能发言!'),x=Object(o["j"])("发送");function C(t,e,i,n,C,E){var D=Object(o["D"])("wm-table-title"),P=Object(o["D"])("wm-button"),L=Object(o["D"])("wm-table-tr"),R=Object(o["D"])("wm-table"),G=Object(o["D"])("wm-input"),V=Object(o["D"])("wm-dialog"),A=Object(o["D"])("wm-main");return Object(o["v"])(),Object(o["f"])(A,null,{default:Object(o["L"])((function(){return[Object(o["k"])(R,{class:"table",ref:"Table",data:t.page.list},{default:Object(o["L"])((function(){return[Object(o["k"])(D,null,{default:Object(o["L"])((function(){return[s,c,r,l,a,u]})),_:1}),(Object(o["v"])(!0),Object(o["h"])(o["a"],null,Object(o["B"])(t.page.list,(function(e,i){return Object(o["v"])(),Object(o["f"])(L,{key:i,value:e.id+""},{default:Object(o["L"])((function(){return[Object(o["i"])("td",null,Object(o["G"])(e.id),1),Object(o["i"])("td",null,Object(o["G"])("room_"+e.id),1),Object(o["i"])("td",null,Object(o["G"])(e.name),1),Object(o["i"])("td",null,[Object(o["k"])(P,{type:"danger",height:"32px",onClick:function(i){return t.RoomJoin("anchor",e.id,e.group_id)}},{default:Object(o["L"])((function(){return[h]})),_:2},1032,["onClick"])]),Object(o["i"])("td",null,[Object(o["k"])(P,{type:"info",height:"32px",onClick:function(i){return t.RoomJoin("audience",e.id,e.group_id)}},{default:Object(o["L"])((function(){return[f]})),_:2},1032,["onClick"])]),d]})),_:2},1032,["value"])})),128))]})),_:1},8,["data"]),Object(o["k"])(V,{title:t.room.title,width:"640px",show:t.room.show,"onUpdate:close":e[7]||(e[7]=function(e){return t.clickClose(e)}),isFooter:!1},{default:Object(o["L"])((function(){return[Object(o["i"])("div",b,[Object(o["i"])("div",m,[Object(o["i"])("div",{class:"player_msg_wrapper",ref:"MsgBox",onScroll:e[0]||(e[0]=function(){return t.onScroll&&t.onScroll.apply(t,arguments)})},[Object(o["i"])("div",p,[(Object(o["v"])(!0),Object(o["h"])(o["a"],null,Object(o["B"])(t.form.lists,(function(t,e){return Object(o["v"])(),Object(o["h"])("div",{class:"player_msg_box",key:e},[Object(o["i"])("div",g,[j,Object(o["i"])("div",v,"ID:"+Object(o["G"])(t.uid),1)]),Object(o["i"])("div",O,Object(o["G"])(t.text),1)])})),128))],512)],544)]),"anchor"==t.room.role?(Object(o["v"])(),Object(o["h"])("ul",y,[Object(o["i"])("li",{class:Object(o["q"])(t.tools.camera?"active":""),onClick:e[1]||(e[1]=function(e){return t.setCamera(!t.tools.camera)})},"视频",2),Object(o["i"])("li",{class:Object(o["q"])(t.tools.microphone?"active":""),onClick:e[2]||(e[2]=function(e){return t.setMicrophone(!t.tools.microphone)})},"麦风",2),Object(o["i"])("li",{class:Object(o["q"])(t.tools.push?"active":""),onClick:e[3]||(e[3]=function(e){return t.setPush(!t.tools.push)})},"推流",2)])):Object(o["g"])("",!0),_]),w,Object(o["i"])("div",T,[Object(o["i"])("div",k,[t.form.login?(Object(o["v"])(),Object(o["f"])(G,{key:1,value:t.form.content,"onUpdate:value":e[5]||(e[5]=function(e){return t.form.content=e}),placeholder:"消息内容"},null,8,["value"])):(Object(o["v"])(),Object(o["h"])("div",M,[I,Object(o["i"])("b",{onClick:e[4]||(e[4]=function(e){return t.roomLogin()})},"登录"),S]))]),Object(o["k"])(P,{height:"40px",onClick:e[6]||(e[6]=function(e){return t.SendSub()})},{default:Object(o["L"])((function(){return[x]})),_:1})])]})),_:1},8,["title","show"])]})),_:1})}i("99af");var E=i("5502"),D=i("bb82"),P=i("7ab7"),L=i("c2b4"),R=i("bb2f"),G=i("b288"),V=i("0dd2"),A=i("1125"),Y=i("36e0"),J=i("bf46"),N=i("edb5"),B=i("903b"),U=Object(o["l"])({components:{wmMain:G["a"],wmTable:V["a"],wmTableTitle:A["a"],wmTableTr:Y["a"],wmDialog:J["a"],wmInput:N["a"],wmButton:B["a"]},data:function(){var t=Object(E["b"])(),e=t.state,i={list:[],page:1,limit:10,total:0},o={},n={show:!1,title:"",id:"",groupid:"",role:""},s=null,c=null,r=null,l=null,a={login:!1,content:"",isScroll:!0,lists:[]},u={camera:!0,microphone:!0,push:!1};return{state:e,page:i,uinfo:o,room:n,pusher:s,player:c,tim:r,im:l,form:a,tools:u}},mounted:function(){D["a"].getItem("token")&&this.loadData()},beforeUnmount:function(){this.pusher=null},methods:{loadData:function(){var t=this;Object(R["a"])(["/tweblive/trtc.js","/tweblive/tim-js.js"]),setTimeout((function(){Object(R["a"])(["/tweblive/tweblive.js"])}),300),Object(L["a"])("/demo/tweblive/list",{token:D["a"].getItem("token")},(function(e){var i=e.data;if(0!=i.code)return Object(P["a"])(i.msg);t.page.list=i.list})),Object(L["a"])("/demo/tweblive/userInfo",{token:D["a"].getItem("token")},(function(e){var i=e.data;if(0!=i.code)return Object(P["a"])(i.msg);t.uinfo=i.uinfo}))},RoomJoin:function(t,e,i){var o=this;this.room.show=!0,this.room.id=e,this.room.groupid=i,this.room.role=t;var n=this.state.uInfo.uid;this.room.title="anchor"==t?"主播ID: "+n:"观众ID: "+n,"anchor"!=t||this.pusher||(this.pusher=TWebLive.createPusher({userID:n,useStringRoomId:!0}),this.pusher.setLogLevel(4)),"anchor"==t&&(this.setCamera(!0),this.setMicrophone(!0)),"anchor"==t||this.player||(this.player=TWebLive.createPlayer(),this.player.setLogLevel(4)),this.renderView(),this.tim||(this.tim=TIM.create({SDKAppID:this.uinfo.sdk_app_id}),this.tim.setLogLevel(4),this.tim.on(TIM.EVENT.SDK_READY,(function(){o.form.login=!0})),this.tim.on(TIM.EVENT.MESSAGE_RECEIVED,this.roomMassage)),this.roomJoin()},roomJoin:function(){var t=this;this.tim.joinGroup({groupID:this.room.groupid,type:TIM.TYPES.GRP_AVCHATROOM}).then((function(e){var i=e.data.status;console.log("[直播群] 加入:",i,t.room.groupid)})).catch((function(t){console.log("[直播群] 加入:","失败!")}))},roomLogin:function(){var t=this,e=this.uinfo.user_id,i=this.uinfo.user_sig;this.tim.login({userID:e,userSig:i}).then((function(){console.log("[登录]:",e,i),t.tim.quitGroup(t.room.groupid).then((function(e){console.log("[直播群] 退出:","成功"),t.roomJoin()}))})).catch((function(t){console.log("[登录]:",t)}))},roomMassage:function(t){for(var e,i=t.data.length,o=0;o<i;o++)switch(e=t.data[o],e.type){case TIM.TYPES.MSG_TEXT:this.msgText(e);break;case TIM.TYPES.MSG_CUSTOM:this.msgCustom(e);break;case TIM.TYPES.MSG_GRP_TIP:this.msgGroupTip(e);break;case TIM.TYPES.MSG_GRP_SYS_NOTICE:this.msgSystemNotice(e);break;default:break}},msgText:function(t){console.log("消息-文本:",t),this.msgPush({uid:t.from,text:t.payload.text})},msgCustom:function(t){console.log("消息-自定义:",t)},msgGroupTip:function(t){console.log("消息-进群&退群:",t)},msgSystemNotice:function(t){console.log("消息-系统通知:",t)},SendSub:function(){var t=this.form.content;this.sendMsg({text:t})},sendMsg:function(t){var e=this,i=this.tim.createTextMessage({to:this.room.groupid,conversationType:TIM.TYPES.CONV_GROUP,priority:TIM.TYPES.MSG_PRIORITY_NORMAL,payload:t});this.tim.sendMessage(i).then((function(t){console.log("[发送消息]:",t);var i=t.data.message;e.msgPush({uid:e.uinfo.user_id,text:i.payload.text}),e.form.content=""})).catch((function(t){console.log("[发送消息]:",t)}))},onScroll:function(t){var e=t.target.scrollTop,i=this.$refs.MsgBox,o=this.$refs.MsgList;o.clientHeight-i.clientHeight-e<10?this.form.isScroll=!0:this.form.isScroll=!1},msgPush:function(t){var e=this;this.form.lists.push(t),this.form.isScroll&&setTimeout((function(){var t=e.$refs.MsgBox,i=e.$refs.MsgList;t.scrollTop=i.scrollHeight}),100)},renderView:function(){if("anchor"==this.room.role)this.pusher.setRenderView({elementID:"playerView",audio:!0,video:{width:480,height:280,frameRate:10,bitrate:400}}).then((function(){console.log("[本地流]:","成功")})).catch((function(t){console.log("[本地流]:",t)}));else{this.player.setRenderView({elementID:"playerView"});var t=this.room.id,e=this.uinfo.sdk_app_id,i=this.uinfo.user_id,o=this.uinfo.user_sig,n="room://sdkappid=".concat(e,"&roomid=").concat(t,"&userid=").concat(i,"&usersig=").concat(o);this.player.startPlay(n).then((function(){console.log("[远程流]:","成功")})).catch((function(t){console.log("[远程流]:",t)}))}},clickClose:function(t){this.room.show=t,t||("anchor"==this.room.role?(this.tools.camera&&this.setCamera(!1),this.tools.setMicrophone&&this.setMicrophone(!1),this.tools.push&&this.setPush(!1)):this.player.stopPlay())},setCamera:function(t){this.tools.camera=t,t?(console.log("[摄像头]:","打开"),this.pusher.startCamera()):(console.log("[摄像头]:","关闭"),this.pusher.stopCamera())},setMicrophone:function(t){this.tools.microphone=t,t?(console.log("[麦克风]:","打开"),this.pusher.startMicrophone()):(console.log("[麦克风]:","关闭"),this.pusher.stopMicrophone())},setPush:function(t){if("anchor"!=this.room.role)return Object(P["a"])("只有主播才能推流!");if(this.tools.push=t,t){var e=this.room.id,i="stream_"+this.room.id,o=this.uinfo.sdk_app_id,n=this.uinfo.user_id,s=this.uinfo.user_sig,c=this.uinfo.live_domain_name,r="room://sdkappid=".concat(o,"&roomid=").concat(e,"&userid=").concat(n,"&usersig=").concat(s,"&livedomainname=").concat(c,"&streamid=").concat(i);this.pusher.startPush(r).then((function(){console.log("[推流]:","成功")})).catch((function(t){console.log("[推流]:",t)}))}else this.pusher.stopPush().then((function(){console.log("[停止推流]:","成功")})).catch((function(t){console.log("[停止推流]:",t)}))}}});i("6dbb"),i("7c98");U.render=C,U.__scopeId="data-v-54c634f4";e["default"]=U},"6dbb":function(t,e,i){"use strict";i("a120")},"7c98":function(t,e,i){"use strict";i("34c9")},"99af":function(t,e,i){"use strict";var o=i("23e7"),n=i("d039"),s=i("e8b5"),c=i("861d"),r=i("7b0b"),l=i("50c4"),a=i("8418"),u=i("65f0"),h=i("1dde"),f=i("b622"),d=i("2d00"),b=f("isConcatSpreadable"),m=9007199254740991,p="Maximum allowed index exceeded",g=d>=51||!n((function(){var t=[];return t[b]=!1,t.concat()[0]!==t})),j=h("concat"),v=function(t){if(!c(t))return!1;var e=t[b];return void 0!==e?!!e:s(t)},O=!g||!j;o({target:"Array",proto:!0,forced:O},{concat:function(t){var e,i,o,n,s,c=r(this),h=u(c,0),f=0;for(e=-1,o=arguments.length;e<o;e++)if(s=-1===e?c:arguments[e],v(s)){if(n=l(s.length),f+n>m)throw TypeError(p);for(i=0;i<n;i++,f++)i in s&&a(h,f,s[i])}else{if(f>=m)throw TypeError(p);a(h,f++,s)}return h.length=f,h}})},a120:function(t,e,i){},bb2f:function(t,e,i){"use strict";var o=i("b85c"),n=(i("1276"),i("ac1f"),function(t,e){var i,n="js"==e||/js$/i.test(t),s=document.getElementsByTagName(n?"script":"link"),c=Object(o["a"])(s);try{for(c.s();!(i=c.n()).done;){var r=i.value,l=n?"src":"href";if(-1!=r[l].indexOf(t))return!0}}catch(a){c.e(a)}finally{c.f()}return!1});e["a"]=function(t,e,i){var s=[],c=!1;e=e||!1;var r,l=Object(o["a"])(t);try{for(l.s();!(r=l.n()).done;){var a=r.value;if(c=n(a,i),e&&(c=!1),s=a.split("."),"js"==s[s.length-1]||"js"==i){if(!c){var u=document.createElement("script");u.setAttribute("src",a),document.body.appendChild(u)}}else if(("css"==s[s.length-1]||"css"==i)&&!c){var h=document.createElement("link");h.setAttribute("rel","stylesheet"),h.setAttribute("href",a),document.body.appendChild(h)}}}catch(f){l.e(f)}finally{l.f()}}}}]);