"use strict";(self["webpackChunkwebmis_vue"]=self["webpackChunkwebmis_vue"]||[]).push([[107],{1307:function(e,t,i){i.r(t),i.d(t,{default:function(){return ke}});var s=i(6252),l=i(3577);const n=e=>((0,s.dD)("data-v-1b4797f6"),e=e(),(0,s.Cn)(),e),o={class:"app_ct_right"},a={class:"app_action_body flex_left"},d={class:"app_action_list flex_left"},r={class:"app_ct_body"},m={class:"file_path"},c={class:"path"},h={key:0},u=n((()=>(0,s._)("a",null,"返回上级",-1))),f=[u],p=n((()=>(0,s._)("span",{class:"split"},"|",-1))),w=n((()=>(0,s._)("a",null,"全选",-1))),g=[w],_=n((()=>(0,s._)("span",{class:"split"},"|",-1))),k={class:"info"},y={class:"file_body"},v={key:0},b=["onClick"],C=n((()=>(0,s._)("i",{class:"check"},null,-1))),D=[C],x=["onClick"],Z=n((()=>(0,s._)("div",{class:"file_ct"},[(0,s._)("i",{class:"ui ui_folder"})],-1))),I=["title"],F=["onClick"],z=n((()=>(0,s._)("i",{class:"check"},null,-1))),S=[z],U=["onClick"],W={class:"file_ct"},q={key:1,class:"ui ui_file"},R=["title"],j={key:1,class:"folder_null"},A=(0,s.Uk)("新 建"),B=(0,s.Uk)("重命名"),E=(0,s.Uk)("确定"),L=(0,s.Uk)("是否删除已选择文件夹或文件？"),N=(0,s.Uk)("彻底删除");function $(e,t,i,n,u,w){const C=(0,s.up)("wm-main"),z=(0,s.up)("wm-input"),$=(0,s.up)("wm-form-item"),T=(0,s.up)("wm-form"),O=(0,s.up)("wm-button"),V=(0,s.up)("wm-dialog"),P=(0,s.up)("wm-uploader"),G=(0,s.up)("wm-row"),H=(0,s.up)("wm-img-view");return(0,s.wg)(),(0,s.iD)("div",null,[(0,s._)("div",o,[(0,s._)("div",a,[(0,s._)("ul",d,[e.getters.actionShow("upload")?((0,s.wg)(),(0,s.iD)("li",{key:0,onClick:t[0]||(t[0]=t=>e.uploadData())},"上传")):(0,s.kq)("",!0),e.getters.actionShow("mkdir")?((0,s.wg)(),(0,s.iD)("li",{key:1,onClick:t[1]||(t[1]=t=>e.folder.show=!0)},"新建文件夹")):(0,s.kq)("",!0),e.getters.actionShow("rename")?((0,s.wg)(),(0,s.iD)("li",{key:2,onClick:t[2]||(t[2]=t=>e.renameData())},"重命名")):(0,s.kq)("",!0),e.getters.actionShow("remove")?((0,s.wg)(),(0,s.iD)("li",{key:3,onClick:t[3]||(t[3]=t=>e.delData())},"删除")):(0,s.kq)("",!0)])]),(0,s._)("div",r,[(0,s.Wm)(C,null,{default:(0,s.w5)((()=>[(0,s._)("div",m,[(0,s._)("span",c,["/"==e.info.path?((0,s.wg)(),(0,s.iD)("span",h,"根目录")):((0,s.wg)(),(0,s.iD)("span",{key:1,onClick:t[4]||(t[4]=t=>e.backDir())},f)),p,(0,s._)("span",{onClick:t[5]||(t[5]=t=>e.selectAll())},g),_,(0,s._)("span",null,(0,l.zw)(e.info.path),1)]),(0,s._)("span",k,"文件夹( "+(0,l.zw)(e.lists.dirNum)+" ) 文件( "+(0,l.zw)(e.lists.fileNum)+" ) 大小( "+(0,l.zw)(e.lists.size)+" )",1)]),(0,s._)("div",{class:"file_load",style:(0,l.j5)({backgroundImage:"linear-gradient(to right, "+e.theme.primary+", "+e.theme.primary+" "+e.info.loaded+", "+e.theme.minor+" "+e.info.loaded+", "+e.theme.minor+" 100%)"})},[(0,s._)("span",{class:"text",style:(0,l.j5)({width:e.info.loaded})},(0,l.zw)("0%"!=e.info.loaded&&"100%"!=e.info.loaded?e.info.loaded:""),5)],4),(0,s._)("div",y,[0!=e.lists.folder.length||0!=e.lists.files.length?((0,s.wg)(),(0,s.iD)("ul",v,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.lists.folder,((t,i)=>((0,s.wg)(),(0,s.iD)("li",{key:"dir"+i,class:(0,l.C_)(t.check?"file_active":"file_state")},[(0,s._)("div",{class:"file_click",onClick:e=>t.check=!t.check},D,8,b),(0,s._)("div",{class:"file",onClick:i=>e.openFolder(t.name)},[Z,(0,s._)("div",{class:"name nowrap",title:t.name},(0,l.zw)(t.name),9,I)],8,x)],2)))),128)),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.lists.files,((t,i)=>((0,s.wg)(),(0,s.iD)("li",{key:"file"+i,class:(0,l.C_)(t.check?"file_active":"file_state")},[(0,s._)("div",{class:"file_click",onClick:e=>t.check=!t.check},S,8,F),(0,s._)("div",{class:"file",onClick:i=>e.openFile(t.name)},[(0,s._)("div",W,[e.isImg(t.ext)?((0,s.wg)(),(0,s.iD)("div",{key:0,class:"file_img bgImg",style:(0,l.j5)({backgroundImage:"url("+e.info.url+e.lists.path+t.name+")"})},null,4)):((0,s.wg)(),(0,s.iD)("i",q))]),(0,s._)("div",{class:"name nowrap",title:t.name},(0,l.zw)(t.name),9,R)],8,U)],2)))),128))])):((0,s.wg)(),(0,s.iD)("div",j,"文件夹为空"))])])),_:1})])]),(0,s.Wm)(V,{title:"新建文件夹",width:"480px",show:e.folder.show,"onUpdate:close":t[8]||(t[8]=t=>e.folder.show=t)},{footer:(0,s.w5)((()=>[(0,s.Wm)(O,{onClick:t[7]||(t[7]=t=>e.subDir())},{default:(0,s.w5)((()=>[A])),_:1})])),default:(0,s.w5)((()=>[(0,s.Wm)(T,{class:"form"},{default:(0,s.w5)((()=>[(0,s.Wm)($,{label:"名称"},{default:(0,s.w5)((()=>[(0,s.Wm)(z,{value:e.folder.form.name,"onUpdate:value":t[6]||(t[6]=t=>e.folder.form.name=t),width:"90%",placeholder:"文件夹名称"},null,8,["value"])])),_:1})])),_:1})])),_:1},8,["show"]),(0,s.Wm)(V,{title:"重命名",width:"480px",show:e.rename.show,"onUpdate:close":t[11]||(t[11]=t=>e.rename.show=t)},{footer:(0,s.w5)((()=>[(0,s.Wm)(O,{onClick:t[10]||(t[10]=t=>e.subRename())},{default:(0,s.w5)((()=>[B])),_:1})])),default:(0,s.w5)((()=>[(0,s.Wm)(T,{class:"form"},{default:(0,s.w5)((()=>[(0,s.Wm)($,{label:"名称"},{default:(0,s.w5)((()=>[(0,s.Wm)(z,{value:e.rename.form.name,"onUpdate:value":t[9]||(t[9]=t=>e.rename.form.name=t),width:"90%",placeholder:"重命名的名称"},null,8,["value"])])),_:1})])),_:1})])),_:1},8,["show"]),(0,s.Wm)(P,{class:"hide",ref:"Uploader",url:e.upload.url,name:e.upload.name,param:e.upload.param,onProgress:e.upProgress},null,8,["url","name","param","onProgress"]),(0,s.Wm)(V,{title:"下载文件",width:"480px",show:e.down.show,"onUpdate:close":t[13]||(t[13]=t=>e.down.show=t)},{footer:(0,s.w5)((()=>[(0,s.Wm)(O,{onClick:t[12]||(t[12]=t=>e.downFile())},{default:(0,s.w5)((()=>[E])),_:1})])),default:(0,s.w5)((()=>[(0,s.Wm)(G,null,{default:(0,s.w5)((()=>[(0,s.Uk)((0,l.zw)(e.down.filename),1)])),_:1})])),_:1},8,["show"]),(0,s.Wm)(V,{title:"删除",width:"400px",show:e.del.show,"onUpdate:close":t[15]||(t[15]=t=>e.del.show=t)},{footer:(0,s.w5)((()=>[(0,s.Wm)(O,{onClick:t[14]||(t[14]=t=>e.subDel())},{default:(0,s.w5)((()=>[N])),_:1})])),default:(0,s.w5)((()=>[(0,s.Wm)(G,null,{default:(0,s.w5)((()=>[L])),_:1})])),_:1},8,["show"]),(0,s.Wm)(H,{ref:"imgShow",show:e.imgView.show,"onUpdate:close":t[16]||(t[16]=t=>e.imgView.show=t)},null,8,["show"])])}var T=i(3907),O=i(7830),V=i(8907),P=i(6492),G=i(5783),H=i(2367),K=(e="",t="down.txt")=>{const i=new Blob([e],{type:"application/octet-stream"}),s=window.URL.createObjectURL(i),l=document.createElement("a");l.style.display="none",l.href=s,l.setAttribute("download",t),"undefined"===typeof l.download&&l.setAttribute("target","_blank"),document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(s)},Y=i(5219),J=i(1566),M=i(323),Q=i(6675),X=i(7685),ee=i(1460),te=i(8650);function ie(e,t,i,l,n,o){return(0,s.wg)(),(0,s.iD)("div",{class:"wm-uploader",onClick:t[0]||(t[0]=t=>e.upload())},[(0,s.WI)(e.$slots,"default")])}var se=(0,s.aZ)({name:"UpLoader",props:{url:{type:String,default:""},name:{type:String,default:"up"},param:{type:Object,default:{}}},methods:{upload(){const e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("style","display: none"),e.setAttribute("multiple","multiple"),document.body.appendChild(e),e.click(),e.onchange=()=>{for(let t=0;t<e.files.length;t++){this.param[this.name]=e.files[t];let i=new FormData;for(let e in this.param)i.append(e,this.param[e]);(0,G.Z)(this.url,i,(e=>{const t=e.data;this.$emit("upload",t)}),(()=>{(0,P.Z)("网络加载错误!")}),{onUploadProgress:e=>{this.$emit("progress",e)}})}}}}}),le=i(3744);const ne=(0,le.Z)(se,[["render",ie]]);var oe=ne;const ae={key:0,class:"imgview_load"},de={class:"imgview_img"},re=["src"],me={class:"imgview_info"},ce={class:"nowrap"},he={key:0};function ue(e,t,i,n,o,a){return e.show?((0,s.wg)(),(0,s.iD)("div",{key:0,ref:"ImgBG",class:"imgview_bg",style:(0,l.j5)({backgroundColor:"rgba(0,0,0,"+e.opacity+")"})},[e.loading?((0,s.wg)(),(0,s.iD)("div",ae,[(0,s._)("i",{class:(0,l.C_)(e.iconLoading),style:(0,l.j5)({color:e.loadColor})},null,6)])):(0,s.kq)("",!0),(0,s._)("div",de,[(0,s._)("img",{id:"img",src:e.info.src},null,8,re)]),(0,s._)("div",{class:"imgview_left",onClick:t[0]||(t[0]=t=>e.page(-1))},[0!=e.index?((0,s.wg)(),(0,s.iD)("i",{key:0,class:(0,l.C_)(e.iconLeft)},null,2)):(0,s.kq)("",!0)]),(0,s._)("div",{class:"imgview_right",onClick:t[1]||(t[1]=t=>e.page(1))},[e.index+1!=e.imgs.length?((0,s.wg)(),(0,s.iD)("i",{key:0,class:(0,l.C_)(e.iconRight)},null,2)):(0,s.kq)("",!0)]),(0,s._)("div",me,[(0,s._)("span",ce,[(0,s._)("span",null,"名称: "+(0,l.zw)(e.info.name),1),e.info.size?((0,s.wg)(),(0,s.iD)("span",he,"大小: "+(0,l.zw)(e.info.size),1)):(0,s.kq)("",!0),(0,s._)("span",null,"页码: "+(0,l.zw)(e.index+1)+"/"+(0,l.zw)(e.imgs.length),1)])]),(0,s._)("div",{class:"imgview_close",onClick:t[2]||(t[2]=t=>e.close())},[(0,s._)("i",{class:(0,l.C_)(e.iconClose)},null,2)]),(0,s._)("div",{class:"imgview_full",onClick:t[3]||(t[3]=t=>e.Fullscreen())},[(0,s._)("i",{class:(0,l.C_)(e.iconFull)},null,2)])],4)):(0,s.kq)("",!0)}var fe=(0,s.aZ)({name:"ImgView",props:{show:{type:Boolean,default:!1},opacity:{type:Number,default:.8},loadColor:{type:String,default:"#6FB737"},iconLoading:{type:String,default:"ui ui_loading"},iconLeft:{type:String,default:"ui ui_arrow_left"},iconRight:{type:String,default:"ui ui_right"},iconFull:{type:String,default:"ui ui_full"},iconClose:{type:String,default:"ui ui_close"}},data(){const e=!0,t=0,i=[],s={src:"",name:"",size:""};return{loading:e,index:t,imgs:i,info:s}},mounted(){},methods:{open(e,t){this.imgs=e||[],this.setImg(t),setTimeout((()=>{let e=this.$refs.ImgBG;e&&(e.style.opacity=1)}),300);const i=this;document.onkeydown=function(e){let t=e||window.event||arguments.callee.caller.arguments[0];t&&27==t.keyCode&&i.close()}},page(e){if(e=this.index+e,e<0||e>=this.imgs.length)return!1;this.setImg(e)},close(){setTimeout((()=>{this.$emit("update:close",!1)}),300);let e=this.$refs.ImgBG;e&&(e.style.opacity=0)},setImg(e){const t=this;this.index=e||0,this.info.src=this.imgs[this.index].src,this.info.name=this.imgs[this.index].name,this.info.size=this.imgs[this.index].size||"";let i=document.getElementById("img");i&&(i.style.opacity="0",i.style.width="0",i.style.height="0"),this.loading=!0;let s=new Image;s.src=this.info.src,s.onload=function(){let e=document.body.clientWidth-20,s=document.body.clientHeight-20,l=this.width/this.height,n=e/s,o="auto",a="auto";(this.width>e||this.height>s)&&(l>n?o=e+"px":a=s+"px"),setTimeout((()=>{t.loading=!1,i=document.getElementById("img"),i.style.opacity="1",i.style.width=o,i.style.height=a}),300)}},Fullscreen(){let e=this.$refs.ImgBG;e.webkitRequestFullScreen?document.webkitIsFullScreen?document.webkitCancelFullScreen():e.webkitRequestFullScreen():e.mozRequestFullScreen?document.mozFullScreen?document.mozCancelFullScreen():e.mozRequestFullScreen():e.msRequestFullscreen?document.msFullscreenElement?document.msExitFullscreen():e.msRequestFullscreen():e.requestFullscreen&&(document.exitFullscreen?document.exitFullscreen():e.requestFullscreen())}}});const pe=(0,le.Z)(fe,[["render",ue],["__scopeId","data-v-79f9fd0f"]]);var we=pe,ge=(0,s.aZ)({components:{wmMain:Y.Z,wmRow:J.Z,wmDialog:M.Z,wmForm:Q.Z,wmFormItem:X.Z,wmInput:ee.Z,wmButton:te.Z,wmUploader:oe,wmImgView:we},data(){const e=(0,T.oR)(),t=e.state,i=e.getters,s={primary:O.Z.themes.primary.plain[0],minor:O.Z.themes.primary.plain[2]},l={url:"",path:"/",loaded:"0%"},n={url:"",folder:[],files:[],dirNum:0,fileNum:0,size:"0KB"},o={show:!1,form:{name:""}},a={show:!1,form:{rename:"",name:""}},d={url:"sys_file/upload",name:"up",param:{}},r={show:!1,filename:""},m={show:!1,form:{name:"",files:[]}},c={show:!1,data:[]},h={show:!1,imgs:[],index:0};return{state:t,getters:i,theme:s,info:l,lists:n,folder:o,rename:a,upload:d,down:r,zip:m,del:c,imgView:h}},mounted(){H.Z.getItem("token")&&this.loadData()},methods:{loadData(){const e=(0,V.Z)();(0,G.Z)("sys_file/list",{token:H.Z.getItem("token"),path:this.info.path},(t=>{e.clear();const i=t.data;0==i.code&&(this.info.url=i.url,this.lists=i.data)}))},selectAll(){const e=this.lists.folder;for(let i in e)e[i].check=!e[i].check;const t=this.lists.files;for(let i in t)t[i].check=!t[i].check},backDir(){const e=this.info.path.split("/").filter((e=>e));if(e.length<=1)this.info.path="/";else{this.info.path="/";for(let t=0;t<e.length-1;t++)this.info.path+=e[t]+"/"}this.loadData()},subDir(){const e=this.folder.form.name;if(!this.isExist(e))return!1;this.folder.show=!1,this.subAjax("mkdir",{path:this.info.path,name:e})},renameData(){const e=this.getCheckName();e&&(this.rename.show=!0,this.rename.form.rename=e[0],this.rename.form.name=e[0])},subRename(){const e=this.rename.form.rename,t=this.rename.form.name;return t?!!this.isExist(t)&&(this.rename.show=!1,void this.subAjax("rename",{path:this.info.path,rename:e,name:t})):(0,P.Z)("名称不能为空")},uploadData(){this.upload.param={token:H.Z.getItem("token"),path:this.info.path};const e=this.$refs.Uploader;e.upload()},upProgress(e){let t=e.loaded/e.total*100|0;t<100?this.info.loaded=t+"%":(this.info.loaded="0%",setTimeout((()=>{this.loadData()}),1e3))},downFile(){this.down.show=!1,(0,G.Z)("sys_file/down",{token:H.Z.getItem("token"),path:this.info.path,filename:this.down.filename},(e=>{K(e.data,this.down.filename)}),(()=>{(0,P.Z)("网络加载错误!")}),{responseType:"blob"})},delData(){const e=this.getCheckName();e&&(this.del.show=!0,this.del.data=e)},subDel(){const e=JSON.stringify(this.del.data);this.del.show=!1,this.subAjax("remove",{path:this.info.path,data:e})},openFolder(e){this.info.path+=e+"/",this.loadData()},openFile(e){const t=this.getType(e);if(this.isImg(t)){const t=this.lists.files;let i=[],s=0;for(let l in t)this.isImg(t[l].ext)&&(e==t[l].name&&(s=i.length),i.push({src:this.info.url+this.lists.path+t[l].name,name:t[l].name,size:t[l].size}));this.imgView.show=!0,this.$refs.imgShow.open(i,s)}else this.down.show=!0,this.down.filename=e},isImg(e){const t=["png","jpg","jpeg","gif","svg"],i=t.indexOf(e);return i>=0},isExist(e){if(!e)return(0,P.Z)("请填写名称"),!1;let t=!0;const i=this.lists.folder,s=this.lists.files;for(let l in i)i[l].name==e&&((0,P.Z)("已存在文件夹"),t=!1);for(let l in s)s[l].name==e&&((0,P.Z)("已存在文件"),t=!1);return t},getCheckName(){const e=this.lists.folder,t=this.lists.files;let i=[];for(let s in e)e[s].check&&i.push(e[s].name);for(let s in t)t[s].check&&i.push(t[s].name);return i.length<1?((0,P.Z)("请选择内容"),!1):i},getType(e){const t=e.lastIndexOf(".")+1,i=e.length;return e.substring(t,i)},subAjax(e,t,i,s){t.token=H.Z.getItem("token");const l=(0,V.Z)();(0,G.Z)("sys_file/"+e,t,(e=>{l.clear();const t=e.data;i&&i(t),t.msg&&(0,P.Z)(t.msg),0===t.code&&this.loadData()}),(()=>{}),s)}}});const _e=(0,le.Z)(ge,[["render",$],["__scopeId","data-v-1b4797f6"]]);var ke=_e}}]);